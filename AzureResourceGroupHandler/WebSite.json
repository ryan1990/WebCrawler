{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "managedClusters_webcrawler_name": {
      "defaultValue": "webcrawler",
      "type": "String"
    },
    "registries_WebCrawlerContainerRegistry_name": {
      "defaultValue": "WebCrawlerContainerRegistry",
      "type": "String"
    }
    //"workspaces_defaultworkspace_c721659d_790f_4141_84b2_60cc9c663747_eus_externalid": {
    //  "defaultValue": "/subscriptions/c721659d-790f-4141-84b2-60cc9c663747/resourceGroups/defaultresourcegroup-eus/providers/microsoft.operationalinsights/workspaces/defaultworkspace-c721659d-790f-4141-84b2-60cc9c663747-eus",
    //  "type": "String"
    //},
    //"publicIPAddresses_8e4e5e02_6678_45b7_b93e_a0487e2e2639_externalid": {
    //  "defaultValue": "/subscriptions/c721659d-790f-4141-84b2-60cc9c663747/resourceGroups/MC_webcrawler-rg_webcrawler_eastus/providers/Microsoft.Network/publicIPAddresses/8e4e5e02-6678-45b7-b93e-a0487e2e2639",
    //  "type": "String"
    //}
  },
  "resources": [
    {
      "type": "Microsoft.ContainerRegistry/registries",
      "apiVersion": "2019-12-01-preview",
      //"name": "WebCrawlerContainerRegistryArm",
      "name": "[parameters('registries_WebCrawlerContainerRegistry_name')]",
      "location": "[resourceGroup().location]",
      "sku": {
        "name": "Basic",
        "tier": "Basic"
      },
      "properties": {
        "adminUserEnabled": false,
        "policies": {
          "quarantinePolicy": {
            "status": "disabled"
          },
          "trustPolicy": {
            "type": "Notary",
            "status": "disabled"
          },
          "retentionPolicy": {
            "days": 7,
            "status": "disabled"
          }
        },
        "encryption": {
          "status": "disabled"
        },
        "dataEndpointEnabled": false,
        "publicNetworkAccess": "Enabled"
      }
    },
    {
      "type": "Microsoft.ContainerService/managedClusters",
      "apiVersion": "2020-09-01",
      //"name": "WebCrawlerArm",
      "name": "[parameters('managedClusters_webcrawler_name')]",
      "location": "[resourceGroup().location]",
      "properties": {
        "kubernetesVersion": "1.18.10",
        "dnsPrefix": "[concat(parameters('managedClusters_webcrawler_name'), '-', parameters('managedClusters_webcrawler_name'), '-rg-c72165')]",
        "agentPoolProfiles": [
          {
            "name": "nodepool1",
            "count": 1,
            "vmSize": "Standard_DS2_v2",
            "osDiskSizeGB": 128,
            "osDiskType": "Managed",
            "maxPods": 110,
            "type": "VirtualMachineScaleSets",
            "orchestratorVersion": "1.18.10",
            "enableNodePublicIP": false,
            "nodeLabels": {},
            "mode": "System",
            "osType": "Linux"
          }
        ],
        "servicePrincipalProfile": {
          "clientId": "91737af5-a72a-4021-90da-797930adb090"
        }
      }
    },
    {
      "type": "Microsoft.ContainerService/managedClusters/agentPools",
      "apiVersion": "2020-09-01",
      "name": "[concat(parameters('managedClusters_webcrawler_name'), '/nodepool1')]",
      "dependsOn": [
        "[resourceId('Microsoft.ContainerService/managedClusters', parameters('managedClusters_webcrawler_name'))]"
      ],
      "properties": {
        "count": 1,
        "vmSize": "Standard_DS2_v2",
        "osDiskSizeGB": 128,
        "osDiskType": "Managed",
        "maxPods": 110,
        "type": "VirtualMachineScaleSets",
        "orchestratorVersion": "1.18.10",
        "enableNodePublicIP": false,
        "nodeLabels": {},
        "mode": "System",
        "osType": "Linux"
      }
    }
    //{
    //  "apiVersion": "2015-08-01",
    //  "name": "[parameters('hostingPlanName')]",
    //  "type": "Microsoft.Web/serverfarms",
    //  "location": "[resourceGroup().location]",
    //  "tags": {
    //    "displayName": "HostingPlan"
    //  },
    //  "sku": {
    //    "name": "[parameters('skuName')]",
    //    "capacity": "[parameters('skuCapacity')]"
    //  },
    //  "properties": {
    //    "name": "[parameters('hostingPlanName')]"
    //  }
    //},
    //{
    //  "apiVersion": "2015-08-01",
    //  "name": "[variables('webSiteName')]",
    //  "type": "Microsoft.Web/sites",
    //  "location": "[resourceGroup().location]",
    //  "tags": {
    //    "[concat('hidden-related:', resourceGroup().id, '/providers/Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]": "Resource",
    //    "displayName": "Website"
    //  },
    //  "dependsOn": [
    //    "[resourceId('Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]"
    //  ],
    //  "properties": {
    //    "name": "[variables('webSiteName')]",
    //    "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('hostingPlanName'))]"
    //  }
    //},
    //{
    //  "apiVersion": "2014-04-01",
    //  "name": "[concat(parameters('hostingPlanName'), '-', resourceGroup().name)]",
    //  "type": "Microsoft.Insights/autoscalesettings",
    //  "location": "[resourceGroup().location]",
    //  "tags": {
    //    "[concat('hidden-link:', resourceGroup().id, '/providers/Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]": "Resource",
    //    "displayName": "AutoScaleSettings"
    //  },
    //  "dependsOn": [
    //    "[resourceId('Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]"
    //  ],
    //  "properties": {
    //    "profiles": [
    //      {
    //        "name": "Default",
    //        "capacity": {
    //          "minimum": 1,
    //          "maximum": 2,
    //          "default": 1
    //        },
    //        "rules": [
    //          {
    //            "metricTrigger": {
    //              "metricName": "CpuPercentage",
    //              "metricResourceUri": "[concat(resourceGroup().id, '/providers/Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]",
    //              "timeGrain": "PT1M",
    //              "statistic": "Average",
    //              "timeWindow": "PT10M",
    //              "timeAggregation": "Average",
    //              "operator": "GreaterThan",
    //              "threshold": 80.0
    //            },
    //            "scaleAction": {
    //              "direction": "Increase",
    //              "type": "ChangeCount",
    //              "value": 1,
    //              "cooldown": "PT10M"
    //            }
    //          },
    //          {
    //            "metricTrigger": {
    //              "metricName": "CpuPercentage",
    //              "metricResourceUri": "[concat(resourceGroup().id, '/providers/Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]",
    //              "timeGrain": "PT1M",
    //              "statistic": "Average",
    //              "timeWindow": "PT1H",
    //              "timeAggregation": "Average",
    //              "operator": "LessThan",
    //              "threshold": 60.0
    //            },
    //            "scaleAction": {
    //              "direction": "Decrease",
    //              "type": "ChangeCount",
    //              "value": 1,
    //              "cooldown": "PT1H"
    //            }
    //          }
    //        ]
    //      }
    //    ],
    //    "enabled": false,
    //    "name": "[concat(parameters('hostingPlanName'), '-', resourceGroup().name)]",
    //    "targetResourceUri": "[concat(resourceGroup().id, '/providers/Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]"
    //  }
    //},
    //{
    //  "apiVersion": "2014-04-01",
    //  "name": "[variables('webSiteName')]",
    //  "type": "Microsoft.Insights/components",
    //  "location": "East US",
    //  "dependsOn": [
    //    "[resourceId('Microsoft.Web/sites/', variables('webSiteName'))]"
    //  ],
    //  "tags": {
    //    "[concat('hidden-link:', resourceGroup().id, '/providers/Microsoft.Web/sites/', variables('webSiteName'))]": "Resource",
    //    "displayName": "AppInsightsComponent"
    //  },
    //  "properties": {
    //    "applicationId": "[variables('webSiteName')]"
    //  }
    //}
  ]
}